#!/bin/bash

groupName=$1
chainName=$2
sequenceNumber=$3
bsPort=$4
startPort=$5
endPort=$6

groupLog="/home/holochain/groupLogs/$groupName"

cd

echo "killing bs on port $bsPort"
/home/holochain/Scripts/killProcessByPort $bsPort

typeset -i i END
let END=$endPort i=$startPort
while ((i<=END)); do
    echo "killing hc by port $i"
    
    /home/holochain/Scripts/killProcessByPort $i    
    
    let i++
    let i++
done

backupChainTimeStamp=$(date +%s)
mkdir -p /home/holochain/oldData/$groupName/$chainName/$backupChainTimeStamp
mv /home/holochain/.holochain/$groupName$chainName* /home/holochain/oldData/$groupName/$chainName/$backupChainTimeStamp -r

cd /home/holochain/groupGithubs/$groupName/
git pull origin master
cd

bs --port=$bsPort &

typeset -i i END seqenceNumber
let END=$endPort i=$startPort seqenceNumber=1
while ((i<=END)); do
    echo "spinningUp hc by port $i"
    
    /home/holochain/Scripts/hc.createClusterInstance $groupName $chainName $seqenceNumber $bsPort $i $(( $i +1 ))

    let i++
    let i++
    let seqenceNumber++
done

