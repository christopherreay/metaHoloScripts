#!/bin/bash

groupName=$1
chainName=$2
instanceNumber=$3
bootstrapPort=$4
internalPort=$5
externalPort=$6

chainID=$groupName$chainName$instanceNumber
groupLog="/home/holochain/groupLogs/$groupName"


echo "cloning $chainName to $chainID"
hc clone /home/holochain/groupGithubs/$groupName/$chainName $chainID

/home/holochain/Scripts/hc.rewrite.confFile $chainID $bootstrapPort $internalPort

hc status

echo "genesis of $chainID"
hc gen chain $chainID

hc status

echo "rewritten chain template"
cat /home/holochain/.holochain/$chainID/config.toml

echo "$(date +%s) server restarted"

mkdir -p $groupDir/logs
touch $groupLog/$chainName.log
touch $groupLog/allServers.log
hc serve $chainID $externalPort  &

sleep 2
